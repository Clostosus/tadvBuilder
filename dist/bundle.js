var I=class{constructor(e,t="",o=null,r=null){if(this.key=e,this.text=t,this.parent=o,this.choices=new Map,r instanceof Map)for(let[n,s]of r)this.choices.set(n,s);else if(Array.isArray(r))for(let n of r)n.next&&n.text&&this.choices.set(n.next,n.text)}addChoice(e,t){return this.choices.has(t)?!1:(this.choices.set(t,e),!0)}updateChoice(e,t){return this.choices.has(e)?(this.choices.set(e,t),!0):!1}removeChoice(e){return this.choices.delete(e)}getAllChoices(){return Array.from(this.choices,([e,t])=>({text:t,next:e}))}static fromJson(e,t){if(!e||!t)return null;let o=null;if(typeof t=="string")try{o=JSON.parse(t)}catch(n){return console.error(`Failed to parse JSON for scene ${e}: ${n}`),null}else if(typeof t=="object")o=t;else return console.error(`Failed to parse JSON for scene ${e}: Invalid JSON type`),null;if(!o.text||typeof o.text!="string")return console.error(`Scene ${e} missing text property.`),null;let r=new I(e,o.text,null,[]);if(Array.isArray(o.choices))for(let n of o.choices)!n||typeof n.text!="string"||typeof n.next!="string"||r.addChoice(n.text,n.next);return r}toJSON(){let e=[];for(let[t,o]of this.choices.entries())e.push({text:o,next:t});return e.length===0?{text:this.text}:{text:this.text,choices:e}}};var u=class{constructor(e){this.sceneClass=e,this.scenes=new Map,this.root=null}addScene(e){if(!(e instanceof this.sceneClass)||this.scenes.has(e.key))return!1;if(this.scenes.set(e.key,e),!this.root)return this.root=e,!0;if(!e.parent&&this.root&&this.scenes.size>0){let t=this.findParent(e.key);t?(e.parent=t,t.addChoice(e.text||`to ${e.key}`,e.key)):(this.root.addChoice(e.text||`to ${e.key}`,e.key),e.parent=this.root)}return e.parent&&this.scenes.has(e.parent.key)&&this.scenes.get(e.parent.key).addChoice(e.text||`to ${e.key}`,e.key),!0}findParent(e){for(let t of this.scenes.values())if(t.choices instanceof Map&&t.choices.has(e))return t;return null}getScene(e){return this.scenes.get(e)||null}getScenesDFS(e=this.root){if(!e)return[];let t=[],o=[],r=new Set;for(;o.length>0;){let{scene:n,depth:s}=o.pop();if(r.has(n.key))continue;r.add(n.key),t.push({key:n.key,scene:n,depth:s});let g=[];for(let[i]of n.choices.entries()){let l=this.getScene(i);l?g.push(l):t.push({key:i,scene:null,depth:s+1})}for(let i=g.length-1;i>=0;i--)o.push({scene:g[i],depth:s+1})}return t}editSceneContent(e,t,o){let r=this.scenes.get(e);if(!r)return console.warn(`Scene ${e} not found`),!1;if(t&&(r.text=t),o)for(let[n,s]of o.entries())r.updateChoice(n,s)}removeScene(e){let t=this.scenes.get(e);if(!t)return console.warn(`Scene ${e} not found`),!1;t.parent&&t.parent.removeChoice(t.key);let o=this.getScenesDFS(t);for(let r=o.length-1;r>=0;r--){let{key:n}=o[r];this.scenes.delete(n)}return!0}toJSON(){let e={};for(let[t,o]of this.scenes.entries())e[t]=o.toJSON();return e}static fromJson(e,t){if(!e||typeof e!="object")return null;if(typeof t.fromJson!="function")return console.warn("SceneClass has no method called: fromJson"),null;let o=new u(t);for(let[r,n]of Object.entries(e)){let s=t.fromJson(r,n);if(s)o.addScene(s);else return console.warn(`Failed to load scene ${r}`),null}return o.scenes.size===0?(console.warn("No scenes found in JSON"),null):o}};var a=class{constructor(){throw new Error("Static class")}static async loadFromJson(e,t,o){if(!e||typeof e!="string")return null;let r=null;try{let n=await fetch(e);if(!n.ok)return null;r=await n.json()}catch{return null}return typeof o.fromJson!="function"?(console.warn("StoryClass has no method called: fromJson"),null):o.fromJson(r,t)}static async saveToJson(e,t){if(!e||!t||typeof t!="string")return console.error("Ungültige Eingabeparameter in saveToJson: story = ",e,", filename = ",t),!1;let o=e.toJSON();try{let r=JSON.stringify(o),n=new Blob([r],{type:"text/json"}),s=document.createElement("a");s.href=URL.createObjectURL(n),s.download=t,s.click(),URL.revokeObjectURL(s.href),console.log("Story saved to Json")}catch(r){return console.error("Failed to save story to Json:"+r),!1}return!0}static async saveToHtml(e,t){if(!e||!t||typeof t!="string")return console.error("Ungültige Eingabeparameter in saveToHtml: story = ",e,", filename = ",t),!1;let o="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+U3RvcnktVmlld2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKICAgICAgICB9CiAgICAgICAgaDIgewogICAgICAgICAgICBjb2xvcjogIzBmMTcyYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC4yNXJlbTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2JkNWUxOwogICAgICAgICAgICBwYWRkaW5nOiAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBtYXgtd2lkdGg6IDgwMHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjA2KTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiAwLjZyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDAuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJnYW1lIj48L2Rpdj4KCjxzY3JpcHQ+CiAgICBjb25zdCBzdG9yeSA9IHsKICAgICAgICAvLyBJTlNFUlQgSlNPTiBTVE9SWSBIRVJFCg==",r="ICAgIH07CgogICAgZnVuY3Rpb24gc2hvd1NjZW5lKGtleSkKICAgIHsKICAgICAgICBjb25zdCBzY2VuZSA9IHN0b3J5W2tleV07CiAgICAgICAgaWYgKCFzY2VuZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsgLy8gZGVsZXRlIHByZXZpb3VzIGNvbnRlbnQvc2NlbmUKCiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoMiIpOwogICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0ga2V5OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBzY2VuZS50ZXh0OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dCk7CgogICAgICAgIGlmICghc2NlbmUuY2hvaWNlcyB8fCBzY2VuZS5jaG9pY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygc2NlbmUuY2hvaWNlcykgewogICAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYy50ZXh0OwogICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93U2NlbmUoYy5uZXh0KSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgfQogICAgfQoKICAgIHNob3dTY2VuZSgic3RhcnQiKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==",n=e.toJSON(),s=JSON.stringify(n);s=s.slice(1,-1);try{let g=window.atob(o)+s+window.atob(r),i=new Blob([g],{type:"text/html"}),l=document.createElement("a");l.href=URL.createObjectURL(i),l.download=t,l.click(),URL.revokeObjectURL(l.href),console.log("Story saved to Html")}catch(g){return console.error("Failed to save story to Json:"+g),!1}return!0}};var C=new u(I);function h(c=document.getElementById("tree-output")){if(!c)return;if(!C||!C.root){c.textContent="(noch kein Baum erstellt)";return}let e=C.getScenesDFS(),t=[];for(let r=0;r<e.length;r++){let{key:n,scene:s,depth:g}=e[r],i="";for(let l=0;l<g;l++)i+=l===g-1?"|_ ":"   ";n=String(n),s===null?t.push(i+"["+n+"](MISSING)"):t.push(i+n)}let o=t.join(`
`);c.textContent=o}function m(c=document.getElementById("choices-container")){let e=document.createElement("div");e.className="choice-inputs",e.innerHTML=`
        <input type="text" class="choice-text" placeholder="Entscheidungstext">
        <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
      `,c.appendChild(e)}function b(){let c=document.getElementById("scene-key").value.trim(),e=document.getElementById("scene-text").value.trim();if(!c||!e)return alert("Bitte Schlüssel und Text ausfüllen.");let t=document.querySelectorAll(".choice-inputs"),o=new Map;t.forEach(g=>{let i=g.querySelector(".choice-text").value.trim(),l=g.querySelector(".choice-next").value.trim();i&&l&&o.set(l,i)}),C.addScene(new I(c,e,null,o)),p(c),h(),document.getElementById("scene-key").value="",document.getElementById("scene-text").value="";let r=document.getElementById("choices-container");r.innerHTML=`<div class="choice-inputs">
    <input type="text" class="choice-text" placeholder="Entscheidungstext">
    <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
  </div>`;let n=document.createElement("div");n.textContent=`✅ Szene '${c}' wurde gespeichert.`,n.style.backgroundColor="#dcfce7",n.style.border="1px solid #22c55e",n.style.color="#166534",n.style.padding="0.5rem 1rem",n.style.borderRadius="6px",n.style.marginTop="1rem",n.style.fontSize="0.95rem",document.querySelectorAll(".section")[0].appendChild(n),setTimeout(()=>n.remove(),3e3)}function p(c){let e=C.getScene(c);if(!e)return;let t=`<p><strong>${e.key}</strong>: ${e.text}</p>`;for(let[o,r]of e.choices.entries())t+=`<button disabled>${r} -> ${o}</button><br>`;document.getElementById("preview").innerHTML=t}function A(){if(!C.root){alert("Keine 'start'-Szene gefunden.");return}y("start")}function y(c){let e=document.getElementById("play-area"),t=C.getScene(c);if(!t){e.innerHTML=`<p><em>Szene '${c}' nicht gefunden.</em></p>`;return}let o=`<p><strong>${t.key}</strong>: ${t.text}</p>`;for(let[r,n]of t.choices.entries())o+=`<button onclick="renderScene('${r}')">${n}</button><br>`;e.innerHTML=o}window.addChoiceField=m;window.addScene=b;window.startStory=A;window.renderTree=h;window.renderPreview=p;window.renderScene=y;var f=document.getElementById("json-file"),w=document.getElementById("import-json"),S=document.getElementById("export-json"),x=document.getElementById("export-html"),d=document.getElementById("import-status");window.currentStory=null;w.addEventListener("click",async()=>{if(!f.files.length){d.textContent="Bitte zuerst eine JSON-Datei auswählen.";return}let c=f.files[0],e=URL.createObjectURL(c);try{if(C=await a.loadFromJson(e,I,u),!C){d.textContent="Fehler beim Laden: Story konnte nicht geladen werden.";return}window.currentStory=C,d.textContent=`"${c.name}" erfolgreich geladen (${C.scenes.size} Szenen).`,typeof h=="function"&&h(),typeof A=="function"&&A()}catch(t){d.textContent="Fehler beim Laden: "+t.message}finally{URL.revokeObjectURL(e)}});S.addEventListener("click",()=>{if(!window.currentStory){alert("Keine Story zum Exportieren vorhanden.");return}a.saveToJson(window.currentStory,"story.json")});x.addEventListener("click",()=>{if(!window.currentStory){alert("Keine Story zum Exportieren vorhanden.");return}a.saveToHtml(window.currentStory,"story.html")});
//# sourceMappingURL=bundle.js.map

var C=class{constructor(e,t="",o=null,n=null){if(this.key=e,this.text=t,this.parent=o,this.choices=new Map,n instanceof Map)for(let[c,s]of n)this.choices.set(c,s);else if(Array.isArray(n))for(let c of n)c.next&&c.text&&this.choices.set(c.next,c.text)}addChoice(e,t){return this.choices.has(t)?!1:(this.choices.set(t,e),!0)}updateChoice(e,t){return this.choices.has(e)?(this.choices.set(e,t),!0):!1}removeChoice(e){return this.choices.delete(e)}getAllChoices(){return Array.from(this.choices,([e,t])=>({text:t,next:e}))}static fromJson(e,t){if(!e||!t)return null;let o=null;if(typeof t=="string")try{o=JSON.parse(t)}catch(c){return console.error(`Failed to parse JSON for scene ${e}: ${c}`),null}else if(typeof t=="object")o=t;else return console.error(`Failed to parse JSON for scene ${e}: Invalid JSON type`),null;if(!o.text||typeof o.text!="string")return console.error(`Scene ${e} missing text property.`),null;let n=new C(e,o.text,null,[]);if(Array.isArray(o.choices))for(let c of o.choices)!c||typeof c.text!="string"||typeof c.next!="string"||n.addChoice(c.text,c.next);return n}toJSON(){let e=[];for(let[t,o]of this.choices.entries())e.push({text:o,next:t});return e.length===0?{text:this.text}:{text:this.text,choices:e}}};var I=class{constructor(e){this.sceneClass=e,this.scenes=new Map,this.root=null}addScene(e){if(!(e instanceof this.sceneClass)||this.scenes.has(e.key))return!1;if(this.scenes.set(e.key,e),!this.root)return this.root=e,!0;if(!e.parent&&this.root&&this.scenes.size>0){let t=this.findParent(e.key);t?(e.parent=t,t.addChoice(e.text||`to ${e.key}`,e.key)):(this.root.addChoice(e.text||`to ${e.key}`,e.key),e.parent=this.root)}return e.parent&&this.scenes.has(e.parent.key)&&this.scenes.get(e.parent.key).addChoice(e.text||`to ${e.key}`,e.key),!0}findParent(e){for(let t of this.scenes.values())if(t.choices instanceof Map&&t.choices.has(e))return t;return null}getScene(e){return this.scenes.get(e)||null}static getSceneDepth(e,t){if(!e.has(t.key))return-1;let o=0,n=t;for(;n&&n.parent;)o++,n=n.parent;return o}static getScenesDFS(e,t=this.root){if(!t)return[];let o=[],n=[],c=new Set,s=0;for(t!==e.root&&(s=I.getSceneDepth(e.scenes,t)),n.push({scene:t,depth:s});n.length>0;){let{scene:i,depth:a}=n.pop();if(c.has(i.key))continue;c.add(i.key),o.push({key:i.key,scene:i,depth:a});let g=[];for(let[u]of i.choices.entries()){let m=e.getScene(u);m?g.push(m):o.push({key:u,scene:null,depth:a+1})}for(let u=g.length-1;u>=0;u--)n.push({scene:g[u],depth:a+1})}return o}editSceneContent(e,t,o=null){let n=this.scenes.get(e);if(!n)return console.warn(`Scene ${e} not found`),!1;if(t&&(n.text=t),o)for(let[c,s]of o.entries())n.updateChoice(c,s)||console.warn(`Failed to edit choice ${c} in scene ${e}`);return!0}removeScene(e){let t=this.scenes.get(e);if(!t)return console.warn(`Scene ${e} not found`),!1;t.parent&&t.parent.removeChoice(t.key);let o=I.getScenesDFS(this,t);for(let n=o.length-1;n>=0;n--){let{key:c}=o[n];this.scenes.delete(c)}return!0}toJSON(){let e={};for(let[t,o]of this.scenes.entries())e[t]=o.toJSON();return e}static fromJson(e,t){if(!e||typeof e!="object")return null;if(typeof t.fromJson!="function")return console.warn("SceneClass has no method called: fromJson"),null;let o=new I(t);for(let[n,c]of Object.entries(e)){let s=t.fromJson(n,c);if(s)o.addScene(s);else return console.warn(`Failed to load scene ${n}`),null}return o.scenes.size===0?(console.warn("No scenes found in JSON"),null):o}};var f=class{constructor(){throw new Error("Static class")}static async loadFromJson(e,t,o){if(!e||typeof e!="string")return null;let n=null;try{let c=await fetch(e);if(!c.ok)return null;n=await c.json()}catch{return null}return typeof o.fromJson!="function"?(console.warn("StoryClass has no method called: fromJson"),null):o.fromJson(n,t)}static async saveToJson(e,t){if(!e||!t||typeof t!="string")return console.error("Ungültige Eingabeparameter in saveToJson: story = ",e,", filename = ",t),!1;let o=e.toJSON();try{let n=JSON.stringify(o),c=new Blob([n],{type:"text/json"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=t,s.click(),URL.revokeObjectURL(s.href),console.log("Story saved to Json")}catch(n){return console.error("Failed to save story to Json:"+n),!1}return!0}static async saveToHtml(e,t){if(!e||!t||typeof t!="string")return console.error("Ungültige Eingabeparameter in saveToHtml: story = ",e,", filename = ",t),!1;let o="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+U3RvcnktVmlld2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKICAgICAgICB9CiAgICAgICAgaDIgewogICAgICAgICAgICBjb2xvcjogIzBmMTcyYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC4yNXJlbTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2JkNWUxOwogICAgICAgICAgICBwYWRkaW5nOiAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBtYXgtd2lkdGg6IDgwMHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjA2KTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiAwLjZyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDAuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJnYW1lIj48L2Rpdj4KCjxzY3JpcHQ+CiAgICBjb25zdCBzdG9yeSA9IHsKICAgICAgICAvLyBJTlNFUlQgSlNPTiBTVE9SWSBIRVJFCg==",n="ICAgIH07CgogICAgZnVuY3Rpb24gc2hvd1NjZW5lKGtleSkKICAgIHsKICAgICAgICBjb25zdCBzY2VuZSA9IHN0b3J5W2tleV07CiAgICAgICAgaWYgKCFzY2VuZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsgLy8gZGVsZXRlIHByZXZpb3VzIGNvbnRlbnQvc2NlbmUKCiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoMiIpOwogICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0ga2V5OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBzY2VuZS50ZXh0OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dCk7CgogICAgICAgIGlmICghc2NlbmUuY2hvaWNlcyB8fCBzY2VuZS5jaG9pY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygc2NlbmUuY2hvaWNlcykgewogICAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYy50ZXh0OwogICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93U2NlbmUoYy5uZXh0KSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgfQogICAgfQoKICAgIHNob3dTY2VuZSgic3RhcnQiKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==",c=e.toJSON(),s=JSON.stringify(c);s=s.slice(1,-1);try{let i=window.atob(o)+s+window.atob(n),a=new Blob([i],{type:"text/html"}),g=document.createElement("a");g.href=URL.createObjectURL(a),g.download=t,g.click(),URL.revokeObjectURL(g.href),console.log("Story saved to Html")}catch(i){return console.error("Failed to save story to Json:"+i),!1}return!0}};var h=class{static generateTreeAscii(e,t=document.getElementById("tree-output")){if(console.log("StoryTreeRenderer.generateTreeAscii. Parent: "+t.id+" Story: "+e.root.key),!t)return;if(!e||!e.root){t.textContent="(noch kein Baum erstellt)";return}let o=I.getScenesDFS(e,e.root),n=[];for(let s=0;s<o.length;s++){let{key:i,scene:a,depth:g}=o[s],u="";for(let m=0;m<g;m++)u+=m===g-1?"|_ ":"   ";i=String(i),a===null?n.push(u+"["+i+"](MISSING)"):n.push(u+i)}let c=n.join(`
`);t.textContent=c}};var l=new I(C);function d(r,e,t,o="create"){if(!e)return;let n=t?"feedback-success":"feedback-error";if(o==="create"){let c=document.createElement("div");c.textContent=r,c.classList.add("feedback",n),e.appendChild(c),setTimeout(()=>c.remove(),3e3)}else o==="set"&&(e.textContent=r,e.classList.add("feedback",n))}function b(){let r=document.getElementById("choices-container");if(!r){console.error("parentElement is not found.");return}let e=document.createElement("div");e.className="choice-inputs",e.innerHTML=`
        <input type="text" class="choice-text" placeholder="Entscheidungstext">
        <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
      `,r.appendChild(e)}function S(){let r=document.getElementById("scene-key").value.trim(),e=document.getElementById("scene-text").value.trim(),t=document.getElementById("sceneEditor");if(!r||!e){d("Bitte Schlüssel und Text ausfüllen.",t,!1);return}let o=document.querySelectorAll(".choice-inputs"),n=new Map;if(o.forEach(s=>{let i=s.querySelector(".choice-text").value.trim(),a=s.querySelector(".choice-next").value.trim();i&&a&&n.set(a,i)}),!l.addScene(new C(r,e,null,n))){d("Scene could not be added to story, key already exists.",t,!1);return}A(r),h.generateTreeAscii(l),document.getElementById("scene-key").value="",document.getElementById("scene-text").value="";let c=document.getElementById("choices-container");c.innerHTML=`<div class="choice-inputs">
    <input type="text" class="choice-text" placeholder="Entscheidungstext">
    <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
    </div>`,d("Szene wurde gespeichert.",t,!0)}function p(){if(!l.root){alert("Keine 'start'-Szene gefunden.");return}A("start")}function A(r){let e=document.getElementById("play-area"),t=l.getScene(r);if(e.innerHTML="",!t){let c=document.createElement("p"),s=document.createElement("em");s.textContent="Szene '"+r+"' nicht gefunden.",c.appendChild(s),e.textContent="",e.appendChild(c);return}let o=document.createElement("p"),n=document.createElement("strong");n.textContent=r,o.append(n,": "+t.text),e.appendChild(o);for(let[c,s]of t.choices.entries()){let i=document.createElement("button");i.textContent=s,i.onclick=()=>A(c),e.appendChild(i),e.appendChild(document.createElement("br"))}}function B(){let r=document.getElementById("scene-key"),e=document.getElementById("scene-status"),t=document.getElementById("scene-text"),o=document.getElementById("choices-container"),n=r.value.trim(),c=t.value.trim();if(!n){d("Bitte gib den Schlüssel der zu bearbeitenden Szene ein.",e,!1);return}let s=new Map;for(let a of o.children){if(!a.classList.contains("choice-inputs"))continue;let g=a.querySelector(".choice-text"),u=a.querySelector(".choice-next");(!g||!u||!(g instanceof HTMLInputElement)||!(u instanceof HTMLInputElement))&&console.log("Error in editScene: Invalid choice input elements. Skipping choice."),s.set(u.value.trim(),g.value.trim())}l.editSceneContent(n,c,s)&&(A(n),d("Szene wurde erfolgreich bearbeitet.",e,!0))}function y(){let r=document.getElementById("scene-key"),e=r.value.trim(),t=document.getElementById("scene-status");if(!e){d("Bitte gib den Schlüssel der zu löschenden Szene ein.",t,!1);return}if(!confirm(`Soll die Szene "${e}" wirklich gelöscht werden?`))return;if(!l.removeScene(e)){d(`Keine Szene mit dem Schlüssel "${e}" gefunden.`,t,!1);return}A(l.root.key),d(`Szene "${e}" wurde erfolgreich gelöscht.`,t,!0),r.value="",document.getElementById("scene-text").value="",h.generateTreeAscii(l)}async function x(){let r=document.getElementById("json-file"),e=document.getElementById("import-status");if(!r.files.length){d("Bitte zuerst eine JSON-Datei auswählen.",e,!1);return}let t=r.files[0],o=URL.createObjectURL(t);try{if(l=await f.loadFromJson(o,C,I),!l){e.textContent="Fehler beim Laden: Story konnte nicht geladen werden.";return}d(`"${t.name}" erfolgreich geladen (${l.scenes.size} Szenen).`,e,!0),h.generateTreeAscii(l),p()}catch(n){d("Fehler beim Laden: "+n.message,e,!1)}finally{URL.revokeObjectURL(o)}}function k(){if(!l){d("No story available to export.",document.getElementById("import-status"),!1);return}f.saveToJson(l,"story.json")&&d("Story successfully exported to JSON.",document.getElementById("import-status"),!0)}function w(){if(!l){d("No story available to export.",document.getElementById("import-status"),!1);return}f.saveToHtml(l,"story.html")&&d("Story successfully exported to HTML.",document.getElementById("import-status"),!0)}window.renderScene=A;window.removeScene=y;window.addEventListener("DOMContentLoaded",()=>{console.log("page is fully loaded"),document.getElementById("add-choice-field").addEventListener("click",b),document.getElementById("add-scene").addEventListener("click",S),document.getElementById("remove-scene").addEventListener("click",y),document.getElementById("edit-scene").addEventListener("click",B),document.getElementById("start-story").addEventListener("click",p),document.getElementById("btn-ascii-tree-refresh").addEventListener("click",()=>{h.generateTreeAscii(l)}),document.getElementById("import-json").addEventListener("click",x),document.getElementById("export-json").addEventListener("click",k),document.getElementById("export-html").addEventListener("click",w)});
//# sourceMappingURL=bundle.js.map

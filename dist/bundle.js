var A=class r{constructor(e,t="",n=null,o=null){if(this.key=e,this.text=t,this.parent=n,this.choices=new Map,o instanceof Map)for(let[c,s]of o)this.choices.set(c,s);else if(Array.isArray(o))for(let c of o)c.next&&c.text&&this.choices.set(c.next,c.text)}addChoice(e,t){return this.choices.has(t)?!1:(this.choices.set(t,e),!0)}updateChoice(e,t){return this.choices.has(e)?(this.choices.set(e,t),!0):!1}removeChoice(e){return this.choices.delete(e)}getAllChoices(){return Array.from(this.choices,([e,t])=>({text:t,next:e}))}static fromJson(e,t){if(!e||!t)return null;let n=null;if(typeof t=="string")try{n=JSON.parse(t)}catch(c){return console.error(`Failed to parse JSON for scene ${e}: ${c}`),null}else if(typeof t=="object")n=t;else return console.error(`Failed to parse JSON for scene ${e}: Invalid JSON type`),null;if(!n.text||typeof n.text!="string")return console.error(`Scene ${e} missing text property.`),null;let o=new r(e,n.text,null,[]);if(Array.isArray(n.choices))for(let c of n.choices)!c||typeof c.text!="string"||typeof c.next!="string"||o.addChoice(c.text,c.next);return o}toJSON(){let e=[];for(let[t,n]of this.choices.entries())e.push({text:n,next:t});return e.length===0?{text:this.text}:{text:this.text,choices:e}}};var u=class r{constructor(){this.scenes=new Map,this.root=null}addScene(e){if(this.scenes.has(e.key))return!1;if(this.scenes.set(e.key,e),!this.root)return this.root=e,!0;if(!e.parent&&this.root&&this.scenes.size>0){let t=this.findParent(e.key);t?(e.parent=t,t.addChoice(e.text||`to ${e.key}`,e.key)):(this.root.addChoice(e.text||`to ${e.key}`,e.key),e.parent=this.root)}return e.parent&&this.scenes.has(e.parent.key)&&this.scenes.get(e.parent.key).addChoice(e.text||`to ${e.key}`,e.key),!0}findParent(e){for(let t of this.scenes.values())if(t.choices instanceof Map&&t.choices.has(e))return t;return null}getScene(e){return this.scenes.get(e)||null}static getSceneDepth(e,t){if(!e.has(t.key))return-1;let n=0,o=t;for(;o&&o.parent;)n++,o=o.parent;return n}static getScenesDFS(e,t=e.root){if(!e||!t)return[];let n=[],o=[],c=new Set,s=0;for(t!==e.root&&(s=r.getSceneDepth(e.scenes,t)),o.push({scene:t,depth:s});o.length>0;){let{scene:g,depth:i}=o.pop();if(c.has(g.key))continue;c.add(g.key),n.push({key:g.key,scene:g,depth:i});let l=Array.from(g.choices.keys()).map(I=>e.getScene(I)).filter(I=>I&&!c.has(I.key));for(let I=l.length-1;I>=0;I--)o.push({scene:l[I],depth:i+1})}return n}static hasCircle(e){let t=new Set,n=r.getScenesDFS(e);for(let{scene:o}of n)if(o){for(let c of o.choices.keys()){let s=e.getScene(c);if(s&&t.has(s.key))return!0}t.add(o.key)}return!1}editSceneContent(e,t,n=null){let o=this.scenes.get(e);if(!o)return console.warn(`Scene ${e} not found`),!1;if(t&&(o.text=t),n)for(let[c,s]of n.entries())o.updateChoice(c,s)||console.warn(`Failed to edit choice ${c} in scene ${e}`);return!0}editSceneChoices(e,t){let n=this.scenes.get(e);return n?(n.choices=new Map(t),!0):(console.warn(`Scene ${e} not found`),!1)}changeSceneParent(e,t){let n=this.scenes.get(e);n||console.warn(`Scene ${e} not found`);let o=n.parent.choices.get(n.key).text;n.parent.removeChoice(n.key);let c=this.scenes.get(t);return c?(n.parent=c,c.addChoice(o||`to ${n.key}`,n.key),!0):(n.parent=null,!1)}removeScene(e){let t=this.scenes.get(e);if(!t)return console.warn(`Scene ${e} not found`),!1;t.parent&&t.parent.removeChoice(t.key);let n=r.getScenesDFS(this,t);for(let o=n.length-1;o>=0;o--){let{key:c}=n[o];this.scenes.delete(c)}return!0}toJSON(){let e={};for(let[t,n]of this.scenes.entries())e[t]=n.toJSON();return e}static fromJson(e){if(!e||typeof e!="object")return null;let t=new r(A);for(let[n,o]of Object.entries(e)){let c=A.fromJson(n,o);if(c)t.addScene(c);else return console.warn(`Failed to load scene ${n}`),null}return t.scenes.size===0?(console.warn("No scenes found in JSON"),null):t}};var p=class r{constructor(){throw new Error("Static class")}static async loadFromJson(e){if(!e||typeof e!="string")return null;let t=null;try{let n=await fetch(e);if(!n.ok)return null;t=await n.json()}catch{return null}return typeof u.fromJson!="function"?(console.warn("Story has no method called: fromJson"),null):u.fromJson(t)}static async saveToJson(e,t){if(!e||!t||typeof t!="string")return console.error("Ung√ºltige Eingabeparameter in saveToJson: story = ",e,", filename = ",t),!1;let n=e.toJSON();try{let o=JSON.stringify(n),c=new Blob([o],{type:"text/json"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=t,s.click(),URL.revokeObjectURL(s.href),console.log("Story saved to Json")}catch(o){return console.error("Failed to save story to Json:"+o),!1}return!0}static async saveToHtml(e,t){if(!e||!t||typeof t!="string")return console.error("Ung√ºltige Eingabeparameter in saveToHtml: story = ",e,", filename = ",t),!1;let n="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+U3RvcnktVmlld2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKICAgICAgICB9CiAgICAgICAgaDIgewogICAgICAgICAgICBjb2xvcjogIzBmMTcyYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC4yNXJlbTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2JkNWUxOwogICAgICAgICAgICBwYWRkaW5nOiAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBtYXgtd2lkdGg6IDgwMHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjA2KTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiAwLjZyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDAuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJnYW1lIj48L2Rpdj4KCjxzY3JpcHQ+CiAgICBjb25zdCBzdG9yeSA9IHsKICAgICAgICAvLyBJTlNFUlQgSlNPTiBTVE9SWSBIRVJFCg==",o="ICAgIH07CgogICAgZnVuY3Rpb24gc2hvd1NjZW5lKGtleSkKICAgIHsKICAgICAgICBjb25zdCBzY2VuZSA9IHN0b3J5W2tleV07CiAgICAgICAgaWYgKCFzY2VuZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsgLy8gZGVsZXRlIHByZXZpb3VzIGNvbnRlbnQvc2NlbmUKCiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoMiIpOwogICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0ga2V5OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBzY2VuZS50ZXh0OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dCk7CgogICAgICAgIGlmICghc2NlbmUuY2hvaWNlcyB8fCBzY2VuZS5jaG9pY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygc2NlbmUuY2hvaWNlcykgewogICAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYy50ZXh0OwogICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93U2NlbmUoYy5uZXh0KSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgfQogICAgfQoKICAgIHNob3dTY2VuZSgic3RhcnQiKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==",c=e.toJSON(),s=JSON.stringify(c);s=s.slice(1,-1);try{let g=window.atob(n)+s+window.atob(o),i=new Blob([g],{type:"text/html"}),l=document.createElement("a");l.href=URL.createObjectURL(i),l.download=t,l.click(),URL.revokeObjectURL(l.href),console.log("Story saved to Html")}catch(g){return console.error("Failed to save story to Json:"+g),!1}return!0}static async saveToEncryptedHtml(e,t,n){if(!e||!t||typeof t!="string"||!n)return console.error("Ung√ºltige Parameter in saveToEncryptedHtml"),!1;let o="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+T2JmdXNjYXRlZCBTdG9yeS1WaWV3ZXI8L3RpdGxlPgogICAgPHN0eWxlPgogICAgICAgIGJvZHkgewogICAgICAgICAgICBmb250LWZhbWlseTogc3lzdGVtLXVpLCBzYW5zLXNlcmlmOwogICAgICAgIH0KICAgICAgICBoMiB7CiAgICAgICAgICAgIGNvbG9yOiAjMGYxNzJhOwogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAwLjI1cmVtOwogICAgICAgIH0KICAgICAgICAjZ2FtZSB7CiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmMWY1Zjk7CiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNjYmQ1ZTE7CiAgICAgICAgICAgIHBhZGRpbmc6IDFyZW07CiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgICAgICAgbWFyZ2luOiAwIGF1dG87CiAgICAgICAgICAgIG1heC13aWR0aDogODAwcHg7CiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBwcmUtd3JhcDsKICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuMDYpOwogICAgICAgIH0KICAgICAgICAjZ2FtZSBidXR0b24gewogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjM2I4MmY2OwogICAgICAgICAgICB3aWR0aDogMTAwJTsKICAgICAgICAgICAgY29sb3I6IHdoaXRlOwogICAgICAgICAgICBib3JkZXI6IG5vbmU7CiAgICAgICAgICAgIHBhZGRpbmc6IDAuNnJlbSAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICAgICAgbWFyZ2luLXRvcDogMC41cmVtOwogICAgICAgICAgICBmb250LXdlaWdodDogNTAwOwogICAgICAgIH0KICAgIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgaWQ9ImdhbWUiPjwvZGl2PgoKPHNjcmlwdD4KICAgIC8vID09PSBjb25maWcgPT09CiAgICBjb25zdCBFTkNSWVBURURfU1RPUlkgPSAi",c="IjsKICAgIGNvbnN0IERFQ1JZUFRJT05fS0VZID0gIg==",s="IjsKCiAgICBsZXQgc3RvcnkgPSBudWxsOwoKICAgIGZ1bmN0aW9uIHNob3dTY2VuZShrZXkpCiAgICB7CiAgICAgICAgY29uc3Qgc2NlbmUgPSBzdG9yeVtrZXldOwogICAgICAgIGlmICghc2NlbmUpIHJldHVybjsKCiAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdhbWUiKTsKICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gIiI7IC8vIGRlbGV0ZSBwcmV2aW91cyBjb250ZW50L3NjZW5lCgogICAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaDIiKTsKICAgICAgICB0aXRsZS50ZXh0Q29udGVudCA9IGtleTsgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTsKCiAgICAgICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInAiKTsKICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gc2NlbmUudGV4dDsgY29udGFpbmVyLmFwcGVuZENoaWxkKHRleHQpOwoKICAgICAgICBpZiAoIXNjZW5lLmNob2ljZXMgfHwgc2NlbmUuY2hvaWNlcy5sZW5ndGggPT09IDApIHJldHVybjsKCiAgICAgICAgZm9yIChjb25zdCBjIG9mIHNjZW5lLmNob2ljZXMpIHsKICAgICAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnV0dG9uIik7CiAgICAgICAgICAgIGJ1dHRvbi50ZXh0Q29udGVudCA9IGMudGV4dDsKICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gc2hvd1NjZW5lKGMubmV4dCkpOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uKTsKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIikpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBYT1IgZGVjcnlwdGlvbiB3aXRoIHBvc2l0aW9uIG1peGluZwogICAgZnVuY3Rpb24gZGVjcnlwdFN0b3J5KGVuY3J5cHRlZEhleCwga2V5KSB7CiAgICAgICAgaWYoIWVuY3J5cHRlZEhleCB8fCBlbmNyeXB0ZWRIZXgubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVuY3J5cHRlZCBzdG9yeSBvciBrZXkgbm90IGZvdW5kLiIpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gSGV4IGRlY29kZQogICAgICAgICAgICBjb25zdCBlbmNyeXB0ZWQgPSBuZXcgVWludDhBcnJheShlbmNyeXB0ZWRIZXgubGVuZ3RoIC8gMik7CiAgICAgICAgICAgIGxldCBieXRlSW5kZXggPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuY3J5cHRlZEhleC5sZW5ndGg7IGkgKz0gMikgewogICAgICAgICAgICAgICAgZW5jcnlwdGVkW2J5dGVJbmRleCsrXSA9IHBhcnNlSW50KGVuY3J5cHRlZEhleC5zbGljZShpLCBpICsgMiksIDE2KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3Qga2V5Qnl0ZXMgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUoa2V5KTsKCiAgICAgICAgICAgIGNvbnN0IGRlY3J5cHRlZCA9IG5ldyBVaW50OEFycmF5KGVuY3J5cHRlZC5sZW5ndGgpOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVuY3J5cHRlZC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgZGVjcnlwdGVkW2ldID0gZW5jcnlwdGVkW2ldIF4ga2V5Qnl0ZXNbaSAlIGtleUJ5dGVzLmxlbmd0aF0gXiAoaSAmIDB4RkYpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gbmV3IFRleHREZWNvZGVyKCkuZGVjb2RlKGRlY3J5cHRlZCk7CiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGpzb25TdHJpbmcpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRGVjcnlwdGlvbiBvZiBzdG9yeSBmYWlsZWQ6IiwgZSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBJbml0aWFsaXplIGdhbWUgd2l0aCBhc3luYy9hd2FpdAogICAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUdhbWUoKSB7CiAgICAgICAgY29uc29sZS5sb2coIkluaXRpYWxpemluZyBnYW1lLi4uIik7CgogICAgICAgIHN0b3J5ID0gYXdhaXQgZGVjcnlwdFN0b3J5KEVOQ1JZUFRFRF9TVE9SWSwgREVDUllQVElPTl9LRVkpOwogICAgICAgIHN0b3J5ID0gSlNPTi5wYXJzZShzdG9yeSk7CiAgICAgICAgCiAgICAgICAgaWYgKCFzdG9yeSkgewogICAgICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gIjxwPkVycm9yOiBDb3VsZCBub3QgbG9hZCB0aGUgc3RvcnkuPC9wPiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGNvbnNvbGUubG9nKCJEaXNwbGF5aW5nIGZpcnN0IHNjZW5lLi4uIik7CiAgICAgICAgc2hvd1NjZW5lKCJzdGFydCIpOwogICAgfQoKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7CiAgICAgICAgaW5pdGlhbGl6ZUdhbWUoKS5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkVycm9yIGluaXRpYWxpemluZyBnYW1lOiIsIGVycm9yKTsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImdhbWUiKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICI8cD5BbiBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIGNoZWNrIHRoZSBjb25zb2xlIGZvciBkZXRhaWxzLjwvcD4iOwogICAgICAgIH0pOwogICAgfSk7CgogICAgc3RvcnkgPSBkZWNyeXB0U3RvcnkoRU5DUllQVEVEX1NUT1JZLCBERUNSWVBUSU9OX0tFWSk7CiAgICBzaG93U2NlbmUoInN0YXJ0Iik7Cjwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4=",g=e.toJSON(),i=JSON.stringify(g),l=r.#e(i,n);try{let I=window.atob(o)+`${l}`+window.atob(c)+`${n}`+window.atob(s),a=new Blob([I],{type:"text/html"}),b=document.createElement("a");return b.href=URL.createObjectURL(a),b.download=t,b.click(),URL.revokeObjectURL(b.href),console.log("Encrypted story saved to HTML"),!0}catch(I){return console.error("Failed to save encrypted story: "+I),!1}}static#e(e,t){let n=JSON.stringify(e),o=new TextEncoder().encode(n),c=new TextEncoder().encode(t),s=new Uint8Array(o.length);for(let i=0;i<o.length;i++)s[i]=o[i]^c[i%c.length]^i&255;let g="";for(let i=0;i<s.length;i++){let l=s[i].toString(16).padStart(2,"0");g+=l}return g}};var m=class{static generateTreeAscii(e,t=document.getElementById("tree-output")){if(console.log("StoryTreeRenderer.generateTreeAscii. Parent: "+t.id+" Story: "+e.root.key),!t)return;if(!e||!e.root){t.textContent="(noch kein Baum erstellt)";return}let n=u.getScenesDFS(e,e.root),o=[];for(let s=0;s<n.length;s++){let{key:g,scene:i,depth:l}=n[s],I="";for(let a=0;a<l;a++)I+=a===l-1?"|_ ":"   ";g=String(g),i===null?o.push(I+"["+g+"](MISSING)"):o.push(I+g)}let c=o.join(`
`);t.textContent=c}};var C=class{static show(e,t,n,o="create"){if(!t)return;let c=n?"feedback-success":"feedback-error";if(o==="create"){let s=document.createElement("div");s.textContent=e,s.classList.add("feedback",c),t.appendChild(s),setTimeout(()=>s.remove(),3e3)}else o==="set"&&(t.textContent=e,t.classList.add("feedback",c))}};var h=class r{static render(e,t,n="play-area"){let o=document.getElementById(n);if(!o)return;let c=e.getScene(t);if(o.innerHTML="",!c){let i=document.createElement("p"),l=document.createElement("em");l.textContent="Szene '"+t+"' nicht gefunden.",i.appendChild(l),o.textContent="",o.appendChild(i);return}let s=document.createElement("p"),g=document.createElement("strong");g.textContent=t,s.append(g,": "+c.text),o.appendChild(s);for(let[i,l]of c.choices.entries()){let I=document.createElement("button");I.textContent=l,I.onclick=()=>r.render(e,i,n),o.appendChild(I),o.appendChild(document.createElement("br"))}}};var f=class{constructor(e){this.story=e}static addChoiceField(){let e=document.getElementById("choices-container");if(!e){console.error("parentElement is not found.");return}let t=document.createElement("div");t.className="choice-inputs",t.innerHTML=`
        <input type="text" class="choice-text" placeholder="Entscheidungstext">
        <input type="text" class="choice-next" placeholder="N√§chste Szene (Schl√ºssel)">
      `,e.appendChild(t)}addScene(){let e=document.getElementById("scene-key").value.trim(),t=document.getElementById("scene-text").value.trim(),n=document.getElementById("sceneEditor");if(!e||!t){C.show("Bitte Schl√ºssel und Text ausf√ºllen.",n,!1);return}let o=document.querySelectorAll(".choice-inputs"),c=new Map;if(o.forEach(g=>{let i=g.querySelector(".choice-text").value.trim(),l=g.querySelector(".choice-next").value.trim();i&&l&&c.set(l,i)}),!this.story.addScene(new A(e,t,null,c))){C.show("Scene could not be added to story, key already exists.",n,!1);return}h.render(this.story,e),m.generateTreeAscii(this.story),document.getElementById("scene-key").value="",document.getElementById("scene-text").value="";let s=document.getElementById("choices-container");s.innerHTML=`<div class="choice-inputs">
    <input type="text" class="choice-text" placeholder="Entscheidungstext">
    <input type="text" class="choice-next" placeholder="N√§chste Szene (Schl√ºssel)">
    </div>`,C.show("Szene wurde gespeichert.",n,!0)}editScene(){let e=document.getElementById("scene-key"),t=document.getElementById("scene-status"),n=document.getElementById("scene-text"),o=document.getElementById("choices-container"),c=e.value.trim(),s=n.value.trim();if(!c){C.show("Bitte gib den Schl√ºssel der zu bearbeitenden Szene ein.",t,!1);return}let g=new Map;for(let l of o.children){if(!l.classList.contains("choice-inputs"))continue;let I=l.querySelector(".choice-text"),a=l.querySelector(".choice-next");(!I||!a||!(I instanceof HTMLInputElement)||!(a instanceof HTMLInputElement))&&console.log("Error in editScene: Invalid choice input elements. Skipping choice."),g.set(a.value.trim(),I.value.trim())}this.story.editSceneContent(c,s,g)&&(h.render(this.story,c),C.show("Szene wurde erfolgreich bearbeitet.",t,!0))}removeScene(){let e=document.getElementById("scene-key"),t=e.value.trim(),n=document.getElementById("scene-status");if(!t){C.show("Bitte gib den Schl√ºssel der zu l√∂schenden Szene ein.",n,!1);return}if(!confirm(`Soll die Szene "${t}" wirklich gel√∂scht werden?`))return;if(!this.story.removeScene(t)){C.show(`Keine Szene mit dem Schl√ºssel "${t}" gefunden.`,n,!1);return}h.render(this.story,this.story.root.key),C.show(`Szene "${t}" wurde erfolgreich gel√∂scht.`,n,!0),e.value="",document.getElementById("scene-text").value="",m.generateTreeAscii(this.story)}};var y=class r{static#e=new Map;static#c(e){return this.#e.has(e)||this.#e.set(e,new r(e)),this.#e.get(e)}static render(e,t="tree-html-area"){r.#c(t).render(e)}constructor(e){this.targetElementId=e,this.expanded=new Set}render(e){let t=this.#s();if(!t)return;if(this.#g(t),!this.#r(e)){this.#i(t);return}this.#l(e);let n=this.#I();this.#t(e.root.key,n,e,new Set),t.appendChild(n)}#s(){let e=document.getElementById(this.targetElementId);return e||console.warn(`TreeEditor: container with id "${this.targetElementId}" not found.`),e}#g(e){e.innerHTML=""}#r(e){return!!(e&&e.root)}#i(e){let t=document.createElement("p");t.textContent='Keine Startszene gefunden. Lege zuerst eine Szene mit dem Schl√ºssel "start" an.',e.appendChild(t)}#l(e){this.expanded.has(e.root.key)||this.expanded.add(e.root.key)}#I(){let e=document.createElement("ul");return e.classList.add("story-tree"),e}#t(e,t,n,o){let c=document.createElement("li"),s=n.getScene(e);if(!s){c.textContent=`${e} (Szene nicht gefunden)`,t.appendChild(c);return}let g=this.#C(e,s,n);if(c.appendChild(g),t.appendChild(c),o.has(e)){let a=document.createElement("em");a.textContent=" (Zyklus)",c.appendChild(a);return}if(!this.#n(s)||!this.#o(e))return;let l=document.createElement("ul");c.appendChild(l);let I=new Set(o);I.add(e);for(let[a,b]of s.choices.entries()){let Z=document.createElement("li"),B=document.createElement("span");B.classList.add("tree-edge"),B.textContent=`‚Üí ${b}`,Z.appendChild(B);let G=document.createElement("ul");Z.appendChild(G),l.appendChild(Z),this.#t(a,G,n,I)}}#C(e,t,n){let o=document.createElement("div");o.classList.add("tree-node-header");let c=n&&n.root&&n.root.key===e;if(!c&&this.#n(t)){let g=this.#d(e,n);o.appendChild(g)}else o.appendChild(this.#a());let s=this.#A(e,t);if(o.appendChild(s),!c){let g=this.#u(e,n);s.appendChild(g)}return o}#d(e,t){let n=this.#o(e),o=document.createElement("button");return o.classList.add("tree-toggle"),o.setAttribute("aria-label",n?"Einklappen":"Ausklappen"),o.setAttribute("aria-expanded",String(n)),o.textContent=n?"‚àí":"+",o.addEventListener("click",c=>this.#h(c,e,t)),o}#a(){let e=document.createElement("span");return e.classList.add("tree-toggle-spacer"),e}#A(e,t){let n=document.createElement("span");n.classList.add("tree-node");let o=document.createElement("strong");return o.textContent=e,n.appendChild(o),n}#u(e,t){let n=document.createElement("button");return n.classList.add("tree-delete"),n.setAttribute("aria-label",`Szene "${e}" l√∂schen`),n.textContent="üóë",n.addEventListener("click",o=>{if(o.preventDefault(),o.stopPropagation(),!confirm(`Soll die Szene "${e}" wirklich gel√∂scht werden?`))return;if(!t.removeScene(e)){console.warn(`TreeEditor: Szene "${e}" konnte nicht gel√∂scht werden.`);return}this.expanded.delete(e),this.render(t)}),n}#h(e,t,n){e.preventDefault(),e.stopPropagation(),this.#m(t),this.render(n)}#n(e){return!!(e.choices&&e.choices.size)}#o(e){return this.expanded.has(e)}#m(e){this.expanded.has(e)?this.expanded.delete(e):this.expanded.add(e)}};var d=new u(A),S=new f(d,A);function w(){if(!d.root){alert("Keine 'start'-Szene gefunden.");return}h.render(d,"start")}async function W(){let r=document.getElementById("json-file"),e=document.getElementById("import-status");if(!r.files.length){C.show("Bitte zuerst eine JSON-Datei ausw√§hlen.",e,!1);return}let t=r.files[0],n=URL.createObjectURL(t);try{if(d=await p.loadFromJson(n,A,u),!d){e.textContent="Fehler beim Laden: Story konnte nicht geladen werden.";return}S.story=d,C.show(`"${t.name}" erfolgreich geladen (${d.scenes.size} Szenen).`,e,!0),m.generateTreeAscii(d),y.render(d),w()}catch(o){C.show("Fehler beim Laden: "+o.message,e,!1)}finally{URL.revokeObjectURL(n)}}function k(){if(!d){C.show("No story available to export.",document.getElementById("import-status"),!1);return}p.saveToJson(d,"story.json")&&C.show("Story successfully exported to JSON.",document.getElementById("import-status"),!0)}function x(r){if(!d){C.show("No story available to export.",document.getElementById("import-status"),!1);return}let e=!1;r?e=p.saveToEncryptedHtml(d,"story.html","9oj7k&7C@b@W"):e=p.saveToHtml(d,"story.html"),e&&C.show("Story successfully exported to HTML.",document.getElementById("import-status"),!0)}function V(r){r==="default"?document.documentElement.removeAttribute("data-theme"):document.documentElement.setAttribute("data-theme",r)}window.renderScene=r=>h.render(d,r);window.removeScene=()=>S.removeScene();window.addEventListener("DOMContentLoaded",()=>{console.log("page is fully loaded"),document.getElementById("add-choice-field").addEventListener("click",f.addChoiceField),document.getElementById("add-scene").addEventListener("click",()=>S.addScene()),document.getElementById("remove-scene").addEventListener("click",()=>S.removeScene()),document.getElementById("edit-scene").addEventListener("click",()=>S.editScene()),document.getElementById("start-story").addEventListener("click",w),document.getElementById("btn-ascii-tree-refresh").addEventListener("click",()=>{m.generateTreeAscii(d)});let r=document.getElementById("btn-html-tree-refresh");r&&r.addEventListener("click",()=>y.render(d)),document.getElementById("import-json").addEventListener("click",W),document.getElementById("export-json").addEventListener("click",k),document.getElementById("export-html").addEventListener("click",()=>{let e=document.getElementById("export-antiscraping-check").checked;x(e)}),document.getElementById("theme-select").addEventListener("change",function(){V(this.value)})});
//# sourceMappingURL=bundle.js.map

<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Choose Your Own Adventure</title>
<style>/* Globals */
:root {
    --color-text: #1e293b;        /* primary textcolor */
    --color-background: #f8fafc;  /* Background */
    --color-highlight-background: #c6d9e8;
    --color-foreground: #3b82f6;  /* accent color (e.g. buttons, links) */
    --color-accent: #0ea5e9;      /* secondary accent color for details */

    --color-success: #166534;
    --color-error: #9b2c2c;
}

:root[data-theme="warm"] {
    --color-text: #3a2f2a;
    --color-background: #faf5f1;
    --color-highlight-background: #eee4dd;
    --color-foreground: #b48a76;
    --color-accent: #d4a98c;

    --color-success: #3c6f57;
    --color-error: #9a4a3f;
}

body {
    font-family: system-ui, sans-serif;
    margin: 2rem;
    line-height: 1.6;

    background-color: var(--color-background);
    color: var(--color-text);
}
h1, h2 {
    color: var(--color-text);
}
textarea, input, select {
    display: block;
    margin-top: 0.5rem;
    margin-bottom: 1rem;
    width: 100%;
    padding: 0.6rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid var(--color-foreground);
    box-sizing: border-box;
}
input[type="text"]::before, textarea::before {
    font-family: inherit;
}
label {
    margin-top: 1rem;
    font-weight: bold;
}
button {
    background-color: var(--color-foreground);
    color: var(--color-background);
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-weight: 500;
}
button:hover {
    background-color: var(--color-accent);
}
.section {
    background: var(--color-background);;
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}
.sectionHighlighted {
    background-color: var(--color-highlight-background);
    border-left: 5px solid var(--color-accent);
}
.bluesidebarP {
    font-size: 0.875rem;
    background-color: var(--color-foreground);
    padding: 0.5rem 1rem;
    border-left: 4px solid var(--color-foreground);
    border-radius: 4px;
    margin-bottom: 1rem;
}

.feedback-success {
    color: var(--color-success);
}

.feedback-error {
    color: var(--color-error);
}
.choice-inputs {
    margin-bottom: 1rem;
    display: grid;
    gap: 0.5rem;
}
.help {
    font-size: 0.875rem;
    color: var(--color-text);
    margin-top: -0.5rem;
    margin-bottom: 0.5rem;
}

.intro {
    padding: 1rem;
    margin-bottom: 2rem;
    border-radius: 8px;
    font-size: 0.9rem;
}
.intro h1 {
    font-size: 2rem;
    color: var(--color-foreground);
    margin-bottom: 0.25rem;
}
.intro h2 {
    margin-top: -0.5rem;
    color: var(--color-text);
    font-weight: normal;
    font-size: 1.2rem;
}

#output, #preview, #play-area, #tree-output {
    background: var(--color-background);
    border: 1px solid var(--color-foreground);
    padding: 1rem;
    border-radius: 8px;
    white-space: pre-wrap;
    font-family: ui-monospace, SFMono-Regular, monospace;
}

#play-area button {
    margin-top: 0.5rem;
}</style>
</head>
<body>

<div id="intro" class="intro sectionHighlighted">
    <h1>Choose Your Own Adventure</h1>
    <h2>Ein Tool zum Schreiben verzweigter Entscheidungsgeschichten direkt im Browser</h2>
    <p>Dieses Tool hilft dir beim Erstellen von verzweigten Erlebnissen: sogenannte "Entscheidungsgeschichten".
        Leserinnen und Leser können durch ihre Entscheidungen den Verlauf beeinflussen. Jede Szene bekommt einen eindeutigen Schlüsselnamen,
        einen Text und eine oder mehrere Auswahlmöglichkeiten, die zu anderen Szenen führen. Du kannst Szenen anlegen, verknüpfen,
        Vorschauen anzeigen lassen und am Ende das komplette Story-Konstrukt als JSON weiterverwenden oder speichern - alles direkt im Browser, komplett offline und lokal.</p>
    <p>Design-Theme:</p>
    <label for="theme-select"></label><select id="theme-select">
        <option value="default">Standard</option>
        <option value="warm">Warm Neutral</option>
    </select>
</div>

<div id="sceneEditor" class="section">
    <label>Schlüsselname der Szene:<span class="help">Ein eindeutiger Bezeichner, z. B. <code>start</code> oder <code>kapitel1</code></span></label>
    <label for="scene-key"></label><input type="text" id="scene-key" placeholder="z. B. start">

    <label>Text der Szene:<span class="help">Der eigentliche Erzähltext, der dem Leser angezeigt wird</span></label>
    <label for="scene-text"></label><textarea id="scene-text" rows="4" placeholder="Hier deine Szene eingeben..."></textarea>

    <label>Entscheidungen:<span class="help">Welche Möglichkeiten der Leser hat und wohin sie führen</span></label>
    <div id="choices-container">
        <div class="choice-inputs">
            <input type="text" class="choice-text" placeholder="Entscheidungstext">
            <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
        </div>
    </div>
    <button id="add-choice-field">Weitere Entscheidung hinzufügen</button>
    <button id="add-scene">Szene speichern</button>
    <button id="edit-scene">Szeneninhalt ändern</button>
    <button id="remove-scene">Szene löschen</button>
    <pre id="scene-status">(noch keine Aktion durchgeführt)</pre>
</div>

<div id="play-section" class="section">
    <h2>Interaktive Vorschau</h2>
    <p class="help">Die Geschichte wird ab der Szene mit dem Schlüssel <code>start</code> gestartet</p>
    <button id="start-story">Geschichte starten</button>
    <div id="play-area"></div>
</div>

<div id="tree-section" class="section">
    <h2>Entscheidungsbaum (ASCII-Übersicht)</h2>
    <p class="help">Diese einfache Textdarstellung zeigt, welche Szene zu welcher führt. Sie wird automatisch aus deinem Story-Aufbau generiert.</p>
    <pre id="tree-output">(noch kein Baum erstellt)</pre>
    <button id="btn-ascii-tree-refresh">Entscheidungsbaum aktualisieren</button>
</div>

<div id="import-export-section" class="section">
    <h2><span class="emoji"></span> Geschichte importieren / exportieren</h2>
    <p class="help">Lade eine bestehende Geschichte (JSON) oder exportiere deine aktuelle Arbeit.</p>

    <label for="json-file">JSON-Datei laden:</label>
    <input type="file" id="json-file" accept=".json" />
    <button id="import-json">Importieren von JSON</button>
    <button id="export-json">Exportieren als JSON</button>
    <button id="export-html">Exportieren als HTML</button>

    <pre id="import-status">(kein Import durchgeführt)</pre>
</div>

<script>var C=class{constructor(e,t="",o=null,n=null){if(this.key=e,this.text=t,this.parent=o,this.choices=new Map,n instanceof Map)for(let[c,s]of n)this.choices.set(c,s);else if(Array.isArray(n))for(let c of n)c.next&&c.text&&this.choices.set(c.next,c.text)}addChoice(e,t){return this.choices.has(t)?!1:(this.choices.set(t,e),!0)}updateChoice(e,t){return this.choices.has(e)?(this.choices.set(e,t),!0):!1}removeChoice(e){return this.choices.delete(e)}getAllChoices(){return Array.from(this.choices,([e,t])=>({text:t,next:e}))}static fromJson(e,t){if(!e||!t)return null;let o=null;if(typeof t=="string")try{o=JSON.parse(t)}catch(c){return console.error(`Failed to parse JSON for scene ${e}: ${c}`),null}else if(typeof t=="object")o=t;else return console.error(`Failed to parse JSON for scene ${e}: Invalid JSON type`),null;if(!o.text||typeof o.text!="string")return console.error(`Scene ${e} missing text property.`),null;let n=new C(e,o.text,null,[]);if(Array.isArray(o.choices))for(let c of o.choices)!c||typeof c.text!="string"||typeof c.next!="string"||n.addChoice(c.text,c.next);return n}toJSON(){let e=[];for(let[t,o]of this.choices.entries())e.push({text:o,next:t});return e.length===0?{text:this.text}:{text:this.text,choices:e}}};var I=class{constructor(e){this.sceneClass=e,this.scenes=new Map,this.root=null}addScene(e){if(!(e instanceof this.sceneClass)||this.scenes.has(e.key))return!1;if(this.scenes.set(e.key,e),!this.root)return this.root=e,!0;if(!e.parent&&this.root&&this.scenes.size>0){let t=this.findParent(e.key);t?(e.parent=t,t.addChoice(e.text||`to ${e.key}`,e.key)):(this.root.addChoice(e.text||`to ${e.key}`,e.key),e.parent=this.root)}return e.parent&&this.scenes.has(e.parent.key)&&this.scenes.get(e.parent.key).addChoice(e.text||`to ${e.key}`,e.key),!0}findParent(e){for(let t of this.scenes.values())if(t.choices instanceof Map&&t.choices.has(e))return t;return null}getScene(e){return this.scenes.get(e)||null}static getSceneDepth(e,t){if(!e.has(t.key))return-1;let o=0,n=t;for(;n&&n.parent;)o++,n=n.parent;return o}static getScenesDFS(e,t=this.root){if(!t)return[];let o=[],n=[],c=new Set,s=0;for(t!==e.root&&(s=I.getSceneDepth(e.scenes,t)),n.push({scene:t,depth:s});n.length>0;){let{scene:i,depth:u}=n.pop();if(c.has(i.key))continue;c.add(i.key),o.push({key:i.key,scene:i,depth:u});let d=[];for(let[g]of i.choices.entries()){let m=e.getScene(g);m?d.push(m):o.push({key:g,scene:null,depth:u+1})}for(let g=d.length-1;g>=0;g--)n.push({scene:d[g],depth:u+1})}return o}editSceneContent(e,t,o=null){let n=this.scenes.get(e);if(!n)return console.warn(`Scene ${e} not found`),!1;if(t&&(n.text=t),o)for(let[c,s]of o.entries())n.updateChoice(c,s)||console.warn(`Failed to edit choice ${c} in scene ${e}`);return!0}removeScene(e){let t=this.scenes.get(e);if(!t)return console.warn(`Scene ${e} not found`),!1;t.parent&&t.parent.removeChoice(t.key);let o=I.getScenesDFS(this,t);for(let n=o.length-1;n>=0;n--){let{key:c}=o[n];this.scenes.delete(c)}return!0}toJSON(){let e={};for(let[t,o]of this.scenes.entries())e[t]=o.toJSON();return e}static fromJson(e,t){if(!e||typeof e!="object")return null;if(typeof t.fromJson!="function")return console.warn("SceneClass has no method called: fromJson"),null;let o=new I(t);for(let[n,c]of Object.entries(e)){let s=t.fromJson(n,c);if(s)o.addScene(s);else return console.warn(`Failed to load scene ${n}`),null}return o.scenes.size===0?(console.warn("No scenes found in JSON"),null):o}};var f=class{constructor(){throw new Error("Static class")}static async loadFromJson(e,t,o){if(!e||typeof e!="string")return null;let n=null;try{let c=await fetch(e);if(!c.ok)return null;n=await c.json()}catch{return null}return typeof o.fromJson!="function"?(console.warn("StoryClass has no method called: fromJson"),null):o.fromJson(n,t)}static async saveToJson(e,t){if(!e||!t||typeof t!="string")return console.error("Ungültige Eingabeparameter in saveToJson: story = ",e,", filename = ",t),!1;let o=e.toJSON();try{let n=JSON.stringify(o),c=new Blob([n],{type:"text/json"}),s=document.createElement("a");s.href=URL.createObjectURL(c),s.download=t,s.click(),URL.revokeObjectURL(s.href),console.log("Story saved to Json")}catch(n){return console.error("Failed to save story to Json:"+n),!1}return!0}static async saveToHtml(e,t){if(!e||!t||typeof t!="string")return console.error("Ungültige Eingabeparameter in saveToHtml: story = ",e,", filename = ",t),!1;let o="PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImRlIj4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8dGl0bGU+U3RvcnktVmlld2VyPC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHsKICAgICAgICAgICAgZm9udC1mYW1pbHk6IHN5c3RlbS11aSwgc2Fucy1zZXJpZjsKICAgICAgICB9CiAgICAgICAgaDIgewogICAgICAgICAgICBjb2xvcjogIzBmMTcyYTsKICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMC4yNXJlbTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgewogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmNWY5OwogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2JkNWUxOwogICAgICAgICAgICBwYWRkaW5nOiAxcmVtOwogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7CiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvOwogICAgICAgICAgICBtYXgtd2lkdGg6IDgwMHB4OwogICAgICAgICAgICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7CiAgICAgICAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDEycHggcmdiYSgwLDAsMCwwLjA2KTsKICAgICAgICB9CiAgICAgICAgI2dhbWUgYnV0dG9uIHsKICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzNiODJmNjsKICAgICAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgICAgICAgYm9yZGVyOiBub25lOwogICAgICAgICAgICBwYWRkaW5nOiAwLjZyZW0gMXJlbTsKICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNnB4OwogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgICAgICAgIG1hcmdpbi10b3A6IDAuNXJlbTsKICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDUwMDsKICAgICAgICB9CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5Pgo8ZGl2IGlkPSJnYW1lIj48L2Rpdj4KCjxzY3JpcHQ+CiAgICBjb25zdCBzdG9yeSA9IHsKICAgICAgICAvLyBJTlNFUlQgSlNPTiBTVE9SWSBIRVJFCg==",n="ICAgIH07CgogICAgZnVuY3Rpb24gc2hvd1NjZW5lKGtleSkKICAgIHsKICAgICAgICBjb25zdCBzY2VuZSA9IHN0b3J5W2tleV07CiAgICAgICAgaWYgKCFzY2VuZSkgcmV0dXJuOwoKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiZ2FtZSIpOwogICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAiIjsgLy8gZGVsZXRlIHByZXZpb3VzIGNvbnRlbnQvc2NlbmUKCiAgICAgICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJoMiIpOwogICAgICAgIHRpdGxlLnRleHRDb250ZW50ID0ga2V5OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpOwoKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpOwogICAgICAgIHRleHQudGV4dENvbnRlbnQgPSBzY2VuZS50ZXh0OyBjb250YWluZXIuYXBwZW5kQ2hpbGQodGV4dCk7CgogICAgICAgIGlmICghc2NlbmUuY2hvaWNlcyB8fCBzY2VuZS5jaG9pY2VzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICAgICAgICBmb3IgKGNvbnN0IGMgb2Ygc2NlbmUuY2hvaWNlcykgewogICAgICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJidXR0b24iKTsKICAgICAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gYy50ZXh0OwogICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiBzaG93U2NlbmUoYy5uZXh0KSk7CiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChidXR0b24pOwogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYnIiKSk7CiAgICAgICAgfQogICAgfQoKICAgIHNob3dTY2VuZSgic3RhcnQiKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==",c=e.toJSON(),s=JSON.stringify(c);s=s.slice(1,-1);try{let i=window.atob(o)+s+window.atob(n),u=new Blob([i],{type:"text/html"}),d=document.createElement("a");d.href=URL.createObjectURL(u),d.download=t,d.click(),URL.revokeObjectURL(d.href),console.log("Story saved to Html")}catch(i){return console.error("Failed to save story to Json:"+i),!1}return!0}};var h=class{static generateTreeAscii(e,t=document.getElementById("tree-output")){if(console.log("StoryTreeRenderer.generateTreeAscii. Parent: "+t.id+" Story: "+e.root.key),!t)return;if(!e||!e.root){t.textContent="(noch kein Baum erstellt)";return}let o=I.getScenesDFS(e,e.root),n=[];for(let s=0;s<o.length;s++){let{key:i,scene:u,depth:d}=o[s],g="";for(let m=0;m<d;m++)g+=m===d-1?"|_ ":"   ";i=String(i),u===null?n.push(g+"["+i+"](MISSING)"):n.push(g+i)}let c=n.join(`
`);t.textContent=c}};var l=new I(C);function a(r,e,t,o="create"){if(!e)return;let n=t?"feedback-success":"feedback-error";if(o==="create"){let c=document.createElement("div");c.textContent=r,c.classList.add("feedback",n),e.appendChild(c),setTimeout(()=>c.remove(),3e3)}else o==="set"&&(e.textContent=r,e.classList.add("feedback",n))}function b(){let r=document.getElementById("choices-container");if(!r){console.error("parentElement is not found.");return}let e=document.createElement("div");e.className="choice-inputs",e.innerHTML=`
        <input type="text" class="choice-text" placeholder="Entscheidungstext">
        <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
      `,r.appendChild(e)}function S(){let r=document.getElementById("scene-key").value.trim(),e=document.getElementById("scene-text").value.trim(),t=document.getElementById("sceneEditor");if(!r||!e){a("Bitte Schlüssel und Text ausfüllen.",t,!1);return}let o=document.querySelectorAll(".choice-inputs"),n=new Map;if(o.forEach(s=>{let i=s.querySelector(".choice-text").value.trim(),u=s.querySelector(".choice-next").value.trim();i&&u&&n.set(u,i)}),!l.addScene(new C(r,e,null,n))){a("Scene could not be added to story, key already exists.",t,!1);return}A(r),h.generateTreeAscii(l),document.getElementById("scene-key").value="",document.getElementById("scene-text").value="";let c=document.getElementById("choices-container");c.innerHTML=`<div class="choice-inputs">
    <input type="text" class="choice-text" placeholder="Entscheidungstext">
    <input type="text" class="choice-next" placeholder="Nächste Szene (Schlüssel)">
    </div>`,a("Szene wurde gespeichert.",t,!0)}function p(){if(!l.root){alert("Keine 'start'-Szene gefunden.");return}A("start")}function A(r){let e=document.getElementById("play-area"),t=l.getScene(r);if(e.innerHTML="",!t){let c=document.createElement("p"),s=document.createElement("em");s.textContent="Szene '"+r+"' nicht gefunden.",c.appendChild(s),e.textContent="",e.appendChild(c);return}let o=document.createElement("p"),n=document.createElement("strong");n.textContent=r,o.append(n,": "+t.text),e.appendChild(o);for(let[c,s]of t.choices.entries()){let i=document.createElement("button");i.textContent=s,i.onclick=()=>A(c),e.appendChild(i),e.appendChild(document.createElement("br"))}}function B(){let r=document.getElementById("scene-key"),e=document.getElementById("scene-status"),t=document.getElementById("scene-text"),o=document.getElementById("choices-container"),n=r.value.trim(),c=t.value.trim();if(!n){a("Bitte gib den Schlüssel der zu bearbeitenden Szene ein.",e,!1);return}let s=new Map;for(let u of o.children){if(!u.classList.contains("choice-inputs"))continue;let d=u.querySelector(".choice-text"),g=u.querySelector(".choice-next");(!d||!g||!(d instanceof HTMLInputElement)||!(g instanceof HTMLInputElement))&&console.log("Error in editScene: Invalid choice input elements. Skipping choice."),s.set(g.value.trim(),d.value.trim())}l.editSceneContent(n,c,s)&&(A(n),a("Szene wurde erfolgreich bearbeitet.",e,!0))}function y(){let r=document.getElementById("scene-key"),e=r.value.trim(),t=document.getElementById("scene-status");if(!e){a("Bitte gib den Schlüssel der zu löschenden Szene ein.",t,!1);return}if(!confirm(`Soll die Szene "${e}" wirklich gelöscht werden?`))return;if(!l.removeScene(e)){a(`Keine Szene mit dem Schlüssel "${e}" gefunden.`,t,!1);return}A(l.root.key),a(`Szene "${e}" wurde erfolgreich gelöscht.`,t,!0),r.value="",document.getElementById("scene-text").value="",h.generateTreeAscii(l)}async function x(){let r=document.getElementById("json-file"),e=document.getElementById("import-status");if(!r.files.length){a("Bitte zuerst eine JSON-Datei auswählen.",e,!1);return}let t=r.files[0],o=URL.createObjectURL(t);try{if(l=await f.loadFromJson(o,C,I),!l){e.textContent="Fehler beim Laden: Story konnte nicht geladen werden.";return}a(`"${t.name}" erfolgreich geladen (${l.scenes.size} Szenen).`,e,!0),h.generateTreeAscii(l),p()}catch(n){a("Fehler beim Laden: "+n.message,e,!1)}finally{URL.revokeObjectURL(o)}}function k(){if(!l){a("No story available to export.",document.getElementById("import-status"),!1);return}f.saveToJson(l,"story.json")&&a("Story successfully exported to JSON.",document.getElementById("import-status"),!0)}function w(){if(!l){a("No story available to export.",document.getElementById("import-status"),!1);return}f.saveToHtml(l,"story.html")&&a("Story successfully exported to HTML.",document.getElementById("import-status"),!0)}function v(r){r==="default"?document.documentElement.removeAttribute("data-theme"):document.documentElement.setAttribute("data-theme",r)}window.renderScene=A;window.removeScene=y;window.addEventListener("DOMContentLoaded",()=>{console.log("page is fully loaded"),document.getElementById("add-choice-field").addEventListener("click",b),document.getElementById("add-scene").addEventListener("click",S),document.getElementById("remove-scene").addEventListener("click",y),document.getElementById("edit-scene").addEventListener("click",B),document.getElementById("start-story").addEventListener("click",p),document.getElementById("btn-ascii-tree-refresh").addEventListener("click",()=>{h.generateTreeAscii(l)}),document.getElementById("import-json").addEventListener("click",x),document.getElementById("export-json").addEventListener("click",k),document.getElementById("export-html").addEventListener("click",w),document.getElementById("theme-select").addEventListener("change",function(){v(this.value)})});
//# sourceMappingURL=bundle.js.map</script>
</body>
